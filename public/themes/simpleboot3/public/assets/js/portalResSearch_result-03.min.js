$define(["wgt_util","wgt_readyload","jquery.fileDownload","jquery.mediaQuery","md5",,"jquery.message"],function($0,$,r,$1,$2,$3){function initDefaultData(scp,params){if(!isFrontEnv()&&eval(params.searchDesign)){var urlParam={compId:params.id,searchCategory:params.searchCategory,search_keyword:params.searchKeyword,search_ndesign:params.searchDesign},defaultHtml=ajxaQuery("/interactionApi/search/resp","GET",!0,urlParam);scp.html(defaultHtml)}}function isEmpty(e){return""!=e&&null!=e&&""!=$.trim(e)&&e!=undefined}var onNewsErrorImghandle=function(e,n,t){1==n||"true"==n?$(".js_thumb",e).onErrorImg(t):$(".js_thumb",e).onErrorImg()},imageHandle=function(e,n){var t=n.defaultImage,o=n.definedDefaultImage;onNewsErrorImghandle(e,o,t);var a=2;if(n.isOpenCutMode&&(a=1),n.isRate){var r=n.widthOfRate/n.heightOfRate;$(".p_image",e).putPhotoDiv(a,r)}else $(".p_image",e).putPhotoDiv(a)},textHandle=function(e,n){n.isCutOfSummary&&$(".p_titleB .font",e).fixLineN(n.linesOfCutOfSummary),n.categorySummary&&$(".SummaryMaxLen",e).fixLineN(n.categorySummaryMaxLen)},init=function(){var d=this._params,e=$compCl.getScope(d.id);function s(e,n,t,o){if(e<n.length){var a=n[e];var r=a.substring(a.lastIndexOf(".")+1);var i=r==="doc"||r==="docx"||r==="pdf"||r==="PDF"||r==="mp4"||r==="MP4"||r==="png"||r==="jpg"||r==="jpeg"||r==="gif"||r==="txt"||r==="xml"||r==="xls"||r==="ppt"||r==="xlsx"||r==="pptx"||r==="zip"||r==="tiff"||r==="mvb"||r==="rmvb"||r==="flv"||r==="rar"||r==="exe"||r==="jar"||r==="gif"||r==="tiff"||r==="RAR"||r==="arj";if(i){window.open(a,"_blank")}else{if(l()||r==="html"){v(a)}else{var c=document.createElement("iframe");c.style.display="none";document.body.appendChild(c);c.src=a}}if(e+1<n.length){s(e+1,n,t,o)}}}function l(){return!!(window.ActiveXObject||"ActiveXObject"in window)}function v(e,n,t){var o,a,r=window,i="application/octet-stream",c=t||i,d=e,s=!n&&!t&&d,l=document.createElement("a"),p=function(e){return String(e)},m=r.Blob||r.MozBlob||r.WebKitBlob||p,u=n||"download";if(m=m.call?m.bind(r):Blob,"true"===String(this)&&(c=(d=[d,c])[0],d=d[1]),s&&s.length<2048){u=s.split("/").pop().split("?")[0],l.href=s;var f=decodeURIComponent(l.href);if(f&&-1!==f.indexOf(s)){var g=new XMLHttpRequest;return g.open("GET",s,!0),g.responseType="blob",g.onload=function(e){v(e.target.response,u,i)},setTimeout(function(){g.send()},0),g}}if(/^data\:[\w+\-]+\/[\w+\-]+[,;]/.test(d)){if(!(2096103.424<d.length&&m!==p))return navigator.msSaveBlob?navigator.msSaveBlob(h(d),u):y(d);c=(d=h(d)).type||i}function h(e){for(var n=e.split(/[:;,]/),t=n[1],o=("base64"==n[2]?atob:decodeURIComponent)(n.pop()),a=o.length,r=0,i=new Uint8Array(a);r<a;++r)i[r]=o.charCodeAt(r);return new m([i],{type:t})}function y(e,n){if("download"in l)return l.href=e,l.setAttribute("download",u),l.className="download-js-link",l.innerHTML="downloading...",l.style.display="none",document.body.appendChild(l),setTimeout(function(){l.click(),document.body.removeChild(l),!0===n&&setTimeout(function(){r.URL.revokeObjectURL(l.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return e=e.replace(/^data:([\w\/\-\+]+)/,i),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var t=document.createElement("iframe");document.body.appendChild(t),n||(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),t.src=e,setTimeout(function(){document.body.removeChild(t)},333)}if(o=d instanceof m?d:new m([d],{type:c}),navigator.msSaveBlob)return navigator.msSaveBlob(o,u);if(r.URL)y(r.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===p)try{return y("data:"+c+";base64,"+r.btoa(o))}catch(w){return y("data:"+c+","+encodeURIComponent(o))}(a=new FileReader).onload=function(e){y(this.result)},a.readAsDataURL(o)}return!0}function p(e,n,t,o,a){var r={};r.request_url=n,r.url_param=e,r.requst_type=t||"POST","true"==d.isMock&&(r.url_param.isMock="true");var i=encodeURIComponent(encodeURIComponent(JSON.stringify(r))),c=$.md5Sign(JSON.stringify(r));$.ajax({type:"GET",url:"/comp/portalRouter?",cache:!1,data:{param:i,sign:c},success:function(e){o(e)},error:function(){}})}function m(e){for(var n=window.location.search.substring(1).split("&"),t=0;t<n.length;t++){var o=n[t].split("=");if(o[0]==e)return o[1]}return!1}function n(e,n){var t=decodeURIComponent(decodeURIComponent(m("cateIds")||"{}")),o=(decodeURIComponent(n.searchKeyword),n.compId),a={url:"/comp/portalResSearch/result.do?keyword="+encodeURIComponent(encodeURIComponent(decodeURIComponent(n.searchKeyword)))+"&viewType=1&searchCategory="+n.searchCategory+"&compId="+o+"&cateIds="+t,compId:n.id,currentPage:n.params.currentPage,cateIds:t,searchCategory:n.params.searchCategory,searchKeyword:decodeURIComponent(n.searchKeyword),keyword:encodeURIComponent(encodeURIComponent(decodeURIComponent(n.searchKeyword)))};$(".p_listBox",e).resPaging(a)}initDefaultData(e,d),imageHandle(e,d.picParams),textHandle(e,d.textParams),e.find(".previewBtn").click(function(){var e=$(this).attr("data-previewUrl");window.open("/public/html/pdfjs/viewer/viewernew.html?file="+e,"PDF")}),$.mediaQuery({callback1024:function(){n(e,d)},callback7681024:function(){n(e,d)},callback768:function(){$(".p_OccupyBox .p_page").remove(),function c(e,n){var t=decodeURIComponent(decodeURIComponent(m("cateIds")||"{}")),o=(decodeURIComponent(n.searchKeyword),n.compId),a=encodeURIComponent(encodeURIComponent(decodeURIComponent(n.searchKeyword))),r=n.searchCategory,i={url:"/comp/portalResSearch/result.do?keyword="+a+"&viewType=1&searchCategory="+r+"&compId="+o+"&cateIds="+t,compId:n.id,currentPage:n.params.currentPage,cateIds:t,searchCategory:n.params.searchCategory,searchKeyword:decodeURIComponent(n.searchKeyword),keyword:encodeURIComponent(encodeURIComponent(decodeURIComponent(n.searchKeyword)))};$(".p_listBox",e).resPaging(i)}(e,d)}}),function t(i,e){i.find(".downloadBtn").click(function(){var r=$(this).attr("data_id");!function t(e,n){p({id:e},"/contentApi/files/getCompanyfileIds","POST",n)}(r,function(e){for(var n=(e.data?JSON.parse(e.data):{}).data,t=[],o=0;o<n.length;o++)t.push(n[o].fileId);!function a(e,n,r,i){var t={id:r,fids:e.join(","),appId:n};p({formData:JSON.stringify(t)},"/contentApi/files/findFilesUrlList","POST",function c(e){try{var e=JSON.parse(e.data).data;if(0==e.isLogin)window.location.href=location.origin+"/"+e.loginUrl+"?goToUrl="+location.pathname+encodeURIComponent(location.search);else if(2==e.isLogin){var n;n=0==window.tenant.foreign||"zh_CN"==window.tenant.language?"对不起，您无权限做此操作！":"Sorry, you do not have permission to do this operation!",$.message({msg:n,type:"error"})}else{var t=e.fileUrlList;if(t&&t.length)if(navigator.platform.indexOf("Win"))for(var o=0;o<t.length;o++)window.location.href=t[o];else s(0,t,r,i)}}catch(a){}})}(t,"24",r,i)})})}(e),r.lazyImg()};return{init:init}});