$define(["wgt_util","js/common/metaCountryDataAll","js/common/regionJsonData","regionJsonDataNew","foreignRegionJsonData","foreignRegionJsonData-HN","globalTelCode"],function(p,e,t,i,n,r,a,o){function u(e,t){if("[object Array]"===Object.prototype.toString.call(e)){var i='<div class="treeItemList '+t+'" level="'+t+'">';for(var n in e)"province"===t&&e[n].city&&0!==e[n].city.length||"city"===t&&e[n].region&&0!==e[n].region.length?i+='<div class="treeItem notLeafNode" data-id="'+e[n].id+'" data-val="'+e[n].name+'"><span>'+e[n].name+'</span><i class="iconfont icon_notLeafNode"></i></div>':i+='<div class="treeItem leafNode" data-id="'+e[n].id+'" data-val="'+e[n].name+'"><span>'+e[n].name+"</span></div>";return p(i+="</div>")}}function h(e,n,t){var r={};n.val(""),n.attr("province","").attr("city","").attr("region",""),e.find(".treeItemList").each(function(){var e=p(this).attr("level"),t=p(this).attr("selectedId"),i=p(this).attr("selectedName");r[e]={id:t,name:i},n.attr(e,t),n.val(n.val()+i+",")}),n.val(n.val().replace(/,$/gi,"")),n.trigger("change"),t.callback&&"function"==typeof t.callback&&t.callback.apply(null,[r]),c(e)}function c(e){e.addClass("item_hide")}return p.fn.initRegionTreeSelect=function(l){var s;l=p.extend({},{isForeign:"false",isOrder:"false",province:"",city:"",region:"",defaultValType:"name",first:"false",telFlag:"false"},l);var y=p(this),v=y.find("input");if("true"==l.isOrder)if("zh_HN"!=window.tenant.language&&"true"==l.isForeign){if("false"==l.first){s=foreign_findContryDataByPid("");for(var e=0;e<s.length;e++){s[e].city=foreign_findContryDataByPid(s[e].id);for(var t=0;t<s[e].city.length;t++)s[e].city[t].region=foreign_findContryDataByPid(s[e].city[t].id)}}else s="true"==l.telFlag?global_tel_code:foreign_findContryDataByPid_f("");v.attr("readonly",!1)}else if("zh_HN"==window.tenant.language){s=foreign_findContryDataByPid_HN("");for(e=0;e<s.length;e++){s[e].city=foreign_findContryDataByPid_HN(s[e].id);for(t=0;t<s[e].city.length;t++)s[e].city[t].region=foreign_findContryDataByPid_HN(s[e].city[t].id)}v.attr("readonly",!1)}else{s=mp_findContryDataByPid("0_cn");for(e=0;e<s.length;e++){s[e].city=mp_findContryDataByPid(s[e].id);for(t=0;t<s[e].city.length;t++)s[e].city[t].region=mp_findContryDataByPid(s[e].city[t].id)}v.attr("readonly",!0)}else s=defaultRegionJson;y.addClass("js-regionTreeSelect"),0===y.find('input[type="text"]').length&&(y.append('<input class="form-control" type="text" readonly'),y.append('<i class="e_icon iconfont background_horizon color_assist afterIcon"></i>')),p(document).off("click",".p_NewlyAddedTitleB"),p(document).on("click",".p_NewlyAddedTitleB",function(){l.city=v.attr("city")||"",l.province=v.attr("province")||"",l.region=v.attr("region")||""}),y.on("click",function(e){if(!p(e.target).hasClass("treeItemBox")&&0===p(e.target).parents(".treeItemBox").length){if("false"==l.first&&"zh_CN"!=window.tenant.language&&"zh_HN"!=window.tenant.language){p(this).find("input").attr("autocomplete","off"),s=foreign_findContryDataByPid("");for(var t=foreign_findContryDataByPid(""),i=[],n=[],r=0;r<t.length;r++){var a=t[r];i.push(a.name)}i.sort();for(var o=0;o<i.length;o++)for(var c=0;c<t.length;c++){(a=t[c]).name==i[o]&&(n[o]=t[c])}s=n}if(0===y.find(".treeItemBox").length)!function g(o,c,d,f,l){var s=u(f,l);o.append(s);s.on("click",function(e){var t=p(e.target);if(!t.hasClass("treeItemList")){t.hasClass("treeItem")||(t=t.parents(".treeItem"));var i=t.attr("data-id"),n=t.attr("data-val");if(s.find(".treeItem").removeClass("active"),t.addClass("active"),s.attr("selectedId",i).attr("selectedName",n),"province"===l&&(o.find(".city").remove(),o.find(".region").remove()),"city"===l&&o.find(".region").remove(),t.hasClass("leafNode"))h(o,c,d);else{var r=-1;for(var a in f)if(f[a].id==i){r=a;break}if(r<-1)return;g(o,c,d,"province"===l?f[r].city:f[r].region,"province"===l?"city":"region")}}});("province"===l&&d.province&&""!=d.province||"city"===l&&d.city&&""!=d.city||"region"===l&&d.region&&""!=d.region)&&s.find(".treeItem").each(function(){var e="id"===d.defaultValType?p(this).attr("data-id"):p(this).attr("data-val");if(e==d[l])return p(this).trigger("click"),!1})}(d=p('<div class="treeItemBox"></div>'),v,l,s,"province"),y.append(d);else if(y.find(".treeItemBox").hasClass("item_hide")){var d;!function f(e,t,i){p(e).find(".treeItem").removeClass("hide");var n={province:t.attr("province"),city:t.attr("city"),region:t.attr("region")},r={province:e.find(".province").attr("selectedId"),city:e.find(".city").attr("selectedId"),region:e.find(".region").attr("selectedId")};i.phoneFlag&&e.find(".province").find(".treeItem").each(function(){if(p(this).attr("data-id")==n.province)return p(this).trigger("click"),!1});n.province&&""!==n.province&&n.province!==r.province&&e.find(".province").find(".treeItem").each(function(){if(p(this).attr("data-id")==n.province)return p(this).trigger("click"),!1});n.city&&""!==n.city&&n.city!==r.city&&e.find(".city").find(".treeItem").each(function(){if(p(this).attr("data-id")==n.city)return p(this).trigger("click"),!1});n.region&&""!==n.region&&n.region!==r.region&&e.find(".region").find(".treeItem").each(function(){if(p(this).attr("data-id")==n.region)return p(this).trigger("click"),!1});e.removeClass("item_hide"),"c_area"!=e.prev().attr("id")?e.find(".treeItemList.province").show():e.find(".treeItemList.city").show()}(d=y.find(".treeItemBox"),v,l)}}}),y.find("input").off("input"),y.find("input").on("input",function(e){p(this).trigger("click")}),y.find("input").off("focus"),y.find("input").on("focus",function(e){p(this).trigger("click")}),p(document).on("click",function(e){p(e.target).hasClass("js-regionTreeSelect")||0!==p(e.target).parents(".js-regionTreeSelect").length||c(y.find(".treeItemBox"))}),l.province&&""!==l.province&&v.trigger("click"),"true"==l.telFlag&&p(document).trigger("click")},p});